{"version":3,"sources":["../src/chunk.js"],"names":["getSelLength","node","type","selectors","length","nodes","reduce","memo","n","plugin","size","result","genResult","css","chunks","count","chunk","nextChunk","clone","push","forEach","selCount","map","c","i","toResult"],"mappings":";;;;;;AAAA;;;;;;AAEA;;;;;AAKA,IAAMA,eAAe,SAAfA,YAAe,CAACC,IAAD,EAAU;AAC7B,MAAIA,KAAKC,IAAL,KAAc,MAAlB,EAA0B;AACxB,WAAOD,KAAKE,SAAL,CAAeC,MAAtB;AACD;AACD,MAAIH,KAAKC,IAAL,KAAc,QAAd,IAA0BD,KAAKI,KAAnC,EAA0C;AACxC,WAAO,IAAIJ,KAAKI,KAAL,CAAWC,MAAX,CAAkB,UAACC,IAAD,EAAOC,CAAP,EAAa;AACxC,aAAOD,OAAOP,aAAaQ,CAAb,CAAd;AACD,KAFU,EAER,CAFQ,CAAX;AAGD;AACD,SAAO,CAAP;AACD,CAVD;;AAYA;;;;;;;kBAOe,kBAAQC,MAAR,CAAe,eAAf,EAAgC,YAKpC;AAAA,iFAAP,EAAO;AAAA,uBAJTC,IAIS;AAAA,MAJTA,IAIS,6BAJF,IAIE;AAAA,yBAHTC,MAGS;AAAA,MAHDC,SAGC,+BAHW,YAAM;AACxB,WAAO,EAAP;AACD,GACQ;;AACT,SAAO,UAACC,GAAD,EAAMF,MAAN,EAAiB;AACtB,QAAMG,SAAS,EAAf;AACA,QAAIC,cAAJ;AACA,QAAIC,cAAJ;;AAEA;AACA,QAAMC,YAAY,SAAZA,SAAY,GAAM;AACtBF,cAAQ,CAAR;AACAC,cAAQH,IAAIK,KAAJ,CAAU,EAACb,OAAO,EAAR,EAAV,CAAR;AACAS,aAAOK,IAAP,CAAYH,KAAZ;AACD,KAJD;;AAMA;AACA;AACAH,QAAIR,KAAJ,CAAUe,OAAV,CAAkB,UAACZ,CAAD,EAAO;AACvB,UAAMa,WAAWrB,aAAaQ,CAAb,CAAjB;AACA,UAAI,CAACQ,KAAD,IAAUD,QAAQM,QAAR,GAAmBX,IAAjC,EAAuC;AACrCO;AACD;AACDD,YAAMX,KAAN,CAAYc,IAAZ,CAAiBX,CAAjB;AACAO,eAASM,QAAT;AACD,KAPD;;AASA;AACAV,WAAOG,MAAP,GAAgBA,OAAOQ,GAAP,CAAW,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACnC,aAAOD,EAAEE,QAAF,CAAWb,UAAUY,CAAV,EAAaD,CAAb,CAAX,CAAP;AACD,KAFe,CAAhB;AAGD,GA3BD;AA4BD,CAlCc,C","file":"chunk.js","sourcesContent":["import postcss from 'postcss';\n\n/**\n * Get the number of selectors for a given node.\n * @param {Object} node CSS node in question.\n * @returns {Number} Total number of selectors associated with that node.\n */\nconst getSelLength = (node) => {\n  if (node.type === 'rule') {\n    return node.selectors.length;\n  }\n  if (node.type === 'atrule' && node.nodes) {\n    return 1 + node.nodes.reduce((memo, n) => {\n      return memo + getSelLength(n);\n    }, 0);\n  }\n  return 0;\n};\n\n/**\n * PostCSS plugin that splits the generated result into multiple results based\n * on number of selectors.\n * @param {Number} size Maximum number of rules in a single file.\n * @param {Function} result Options passed to `postcss.toResult()`\n * @returns {Object} `postcss` plugin instance.\n */\nexport default postcss.plugin('postcss-chunk', ({\n  size = 4000,\n  result: genResult = () => {\n    return {};\n  },\n} = {}) => {\n  return (css, result) => {\n    const chunks = [];\n    let count;\n    let chunk;\n\n    // Create a new chunk that holds current result.\n    const nextChunk = () => {\n      count = 0;\n      chunk = css.clone({nodes: []});\n      chunks.push(chunk);\n    };\n\n    // Walk the nodes. When we overflow the selector count, then start a new\n    // chunk. Collect the nodes into the current chunk.\n    css.nodes.forEach((n) => {\n      const selCount = getSelLength(n);\n      if (!chunk || count + selCount > size) {\n        nextChunk();\n      }\n      chunk.nodes.push(n);\n      count += selCount;\n    });\n\n    // Output the results.\n    result.chunks = chunks.map((c, i) => {\n      return c.toResult(genResult(i, c));\n    });\n  };\n});\n"]}